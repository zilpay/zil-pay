import { describe, it, expect } from "vitest";
import { ntruKeysFromSeed } from "../../crypto/ntrup";
import { sha512 } from "../../crypto/sha512";
import { utils } from "aes-js";
import { params761 } from "@hicaru/ntrup.js";

describe("NTRU", () => {
  describe("keys", () => {
    it("converts Uint8Array to valid base64 string", async () => {
      let bytes = utils.utf8.toBytes("hello");
      const seed = await sha512(bytes);
      let { pk, sk } = ntruKeysFromSeed(seed);

      expect(pk.toBytes(params761)).not.toEqual([
        8, 8, 0, 21, 249, 176, 1, 159, 3, 97, 248, 156, 249, 223, 249, 50, 249,
        238, 5, 123, 8, 32, 253, 63, 1, 76, 252, 108, 2, 44, 1, 122, 2, 158, 0,
        24, 7, 17, 7, 210, 0, 117, 3, 125, 250, 219, 1, 248, 253, 226, 6, 102,
        3, 47, 6, 62, 250, 6, 6, 62, 6, 227, 249, 217, 7, 199, 7, 88, 255, 106,
        5, 54, 247, 90, 251, 22, 253, 243, 1, 218, 2, 190, 250, 15, 252, 231, 3,
        54, 255, 174, 5, 242, 6, 254, 0, 197, 248, 177, 252, 252, 1, 201, 2,
        197, 254, 197, 3, 227, 251, 68, 248, 92, 252, 12, 252, 233, 6, 54, 250,
        72, 250, 36, 0, 72, 4, 200, 247, 194, 255, 42, 6, 145, 255, 87, 5, 40,
        255, 27, 255, 224, 255, 112, 249, 2, 249, 133, 249, 252, 0, 11, 253,
        174, 252, 149, 7, 90, 6, 207, 255, 250, 254, 85, 4, 97, 247, 214, 5,
        126, 8, 87, 253, 232, 252, 97, 251, 255, 251, 73, 1, 151, 8, 201, 4,
        254, 3, 219, 254, 51, 248, 208, 3, 195, 6, 13, 2, 128, 251, 217, 247,
        245, 7, 130, 250, 43, 253, 100, 254, 180, 251, 6, 255, 167, 253, 53,
        248, 6, 249, 224, 8, 68, 254, 103, 248, 132, 8, 144, 2, 107, 254, 163,
        251, 201, 247, 14, 0, 116, 3, 99, 8, 191, 252, 4, 255, 246, 250, 52,
        247, 219, 248, 143, 8, 65, 4, 227, 0, 30, 253, 197, 254, 105, 0, 187, 7,
        201, 1, 120, 250, 79, 255, 65, 252, 28, 6, 134, 250, 85, 0, 194, 3, 236,
        8, 26, 248, 234, 6, 217, 3, 55, 250, 56, 5, 123, 8, 55, 254, 73, 253,
        120, 5, 214, 255, 33, 1, 51, 250, 185, 7, 241, 249, 120, 254, 181, 8,
        239, 5, 122, 8, 112, 247, 148, 254, 237, 251, 27, 253, 132, 0, 15, 253,
        100, 253, 194, 253, 52, 3, 105, 0, 95, 248, 233, 250, 86, 254, 124, 7,
        80, 1, 45, 6, 103, 6, 176, 2, 26, 252, 198, 2, 188, 254, 89, 1, 223,
        248, 144, 3, 169, 254, 195, 251, 34, 254, 127, 249, 71, 254, 149, 251,
        75, 5, 36, 5, 171, 3, 203, 8, 1, 255, 64, 5, 160, 249, 126, 247, 53,
        252, 253, 251, 197, 4, 29, 247, 52, 7, 176, 1, 66, 5, 129, 250, 197,
        254, 46, 255, 94, 5, 245, 1, 160, 253, 245, 254, 200, 251, 158, 7, 128,
        249, 138, 5, 159, 248, 79, 5, 130, 2, 239, 1, 158, 0, 118, 6, 59, 252,
        92, 7, 246, 0, 141, 0, 147, 2, 169, 0, 115, 8, 119, 247, 220, 6, 90, 4,
        12, 8, 232, 253, 242, 250, 216, 255, 149, 2, 87, 248, 130, 248, 144,
        255, 34, 247, 120, 1, 110, 248, 159, 248, 255, 7, 182, 0, 243, 7, 130,
        248, 88, 254, 239, 1, 135, 0, 45, 249, 21, 7, 202, 255, 106, 252, 137,
        8, 5, 7, 101, 0, 8, 2, 36, 1, 142, 7, 236, 4, 251, 247, 254, 252, 106,
        0, 220, 2, 101, 247, 94, 249, 127, 3, 217, 0, 62, 0, 56, 248, 182, 250,
        9, 250, 32, 253, 11, 4, 167, 249, 123, 5, 201, 3, 26, 5, 184, 2, 154, 5,
        17, 254, 81, 253, 62, 2, 63, 8, 60, 253, 61, 5, 166, 250, 14, 255, 210,
        3, 123, 8, 228, 8, 183, 254, 126, 5, 151, 255, 121, 248, 22, 250, 126,
        5, 202, 249, 113, 1, 9, 250, 205, 255, 6, 5, 63, 6, 52, 7, 22, 1, 178,
        249, 56, 6, 224, 1, 48, 247, 57, 249, 173, 2, 215, 251, 239, 255, 137,
        251, 106, 6, 131, 8, 182, 248, 201, 5, 51, 7, 213, 253, 241, 8, 181, 6,
        2, 252, 247, 247, 113, 4, 55, 248, 150, 6, 61, 247, 157, 250, 19, 250,
        153, 2, 193, 252, 105, 255, 149, 2, 242, 7, 202, 3, 75, 253, 0, 7, 76,
        3, 78, 6, 52, 1, 245, 251, 121, 252, 47, 250, 186, 250, 11, 250, 232,
        254, 223, 252, 153, 0, 6, 249, 180, 3, 142, 4, 56, 247, 33, 249, 52,
        251, 70, 6, 73, 1, 49, 255, 220, 5, 174, 255, 191, 251, 208, 1, 125, 0,
        215, 253, 81, 247, 137, 247, 61, 1, 157, 255, 247, 247, 40, 255, 76,
        251, 10, 247, 194, 251, 158, 5, 157, 248, 218, 4, 253, 248, 196, 254,
        97, 249, 170, 4, 145, 6, 139, 247, 229, 7, 196, 251, 0, 255, 106, 255,
        209, 2, 168, 0, 187, 5, 86, 252, 132, 0, 199, 2, 112, 248, 231, 247,
        253, 3, 155, 250, 35, 252, 83, 3, 146, 8, 212, 3, 174, 250, 121, 3, 207,
        255, 130, 254, 138, 4, 247, 249, 159, 0, 236, 249, 193, 249, 167, 5, 48,
        250, 237, 249, 8, 8, 77, 250, 238, 0, 117, 249, 60, 7, 38, 1, 13, 5,
        206, 248, 213, 2, 240, 6, 127, 248, 231, 1, 238, 250, 192, 6, 210, 248,
        156, 8, 66, 6, 93, 7, 70, 2, 227, 247, 125, 0, 226, 251, 11, 1, 119,
        252, 6, 1, 106, 6, 66, 255, 92, 253, 82, 0, 242, 2, 186, 254, 117, 2,
        155, 252, 137, 3, 180, 3, 93, 4, 231, 4, 35, 5, 160, 8, 47, 254, 75, 1,
        225, 251, 209, 252, 149, 0, 93, 252, 150, 7, 108, 254, 91, 0, 43, 249,
        207, 253, 181, 250, 8, 7, 140, 249, 246, 249, 199, 252, 154, 253, 105,
        248, 48, 252, 176, 5, 0, 253, 226, 3, 245, 1, 8, 253, 61, 0, 156, 248,
        30, 252, 20, 253, 254, 8, 23, 2, 217, 252, 59, 0, 159, 2, 239, 1, 114,
        249, 150, 248, 153, 3, 1, 252, 238, 8, 230, 249, 4, 252, 54, 248, 187,
        251, 126, 8, 116, 1, 72, 252, 192, 255, 212, 5, 220, 4, 164, 7, 212,
        253, 207, 2, 200, 6, 158, 3, 250, 251, 175, 0, 40, 250, 183, 250, 96, 6,
        38, 1, 163, 255, 125, 255, 167, 251, 10, 254, 84, 1, 249, 2, 169, 250,
        127, 5, 106, 247, 22, 4, 98, 3, 87, 250, 30, 248, 63, 247, 41, 250, 35,
        4, 8, 250, 34, 255, 45, 254, 124, 250, 75, 2, 108, 1, 216, 251, 34, 2,
        117, 3, 169, 252, 49, 251, 250, 7, 130, 255, 107, 252, 81, 252, 83, 2,
        30, 7, 243, 6, 202, 253, 240, 249, 207, 3, 174, 251, 131, 253, 64, 8,
        247, 0, 151, 8, 168, 6, 58, 251, 210, 254, 117, 5, 137, 251, 219, 6, 14,
        255, 30, 249, 126, 5, 90, 249, 244, 251, 165, 248, 228, 3, 122, 7, 56,
        8, 92, 0, 29, 1, 130, 1, 46, 252, 28, 254, 72, 254, 45, 255, 228, 1, 78,
        253, 53, 247, 14, 4, 94, 3, 66, 3, 109, 8, 55, 3, 124, 251, 135, 254,
        105, 249, 178, 7, 125, 7, 2, 2, 181, 4, 27, 251, 11, 4, 106, 3, 166,
        253, 74, 250, 46, 247, 189, 8, 93, 254, 58, 247, 63, 3, 33, 247, 190,
        250, 164, 250, 40, 253, 219, 255, 111, 252, 185, 4, 192, 248, 62, 248,
        87, 7, 4, 7, 247, 1, 185, 252, 13, 2, 202, 247, 27, 6, 201, 250, 34,
        255, 12, 4, 138, 5, 239, 2, 65, 6, 105, 254, 67, 3, 117, 3, 146, 2, 75,
        254, 22, 254, 0, 247, 78, 247, 151, 252, 42, 8, 74, 251, 172, 255, 1, 5,
        122, 249, 160, 251, 223, 4, 255, 252, 112, 5, 228, 8, 152, 255, 230, 2,
        233, 252, 119, 2, 183, 6, 143, 253, 10, 0, 84, 247, 213, 7, 192, 4, 26,
        8, 146, 1, 69, 0, 11, 251, 147, 1, 237, 250, 247, 251, 241, 255, 112, 5,
        207, 2, 249, 252, 70, 252, 168, 2, 160, 248, 132, 5, 97, 248, 221, 255,
        213, 254, 67, 0, 22, 248, 115, 8, 80, 8, 96, 2, 249, 2, 208, 255, 7,
        253, 73, 253, 86, 0, 227, 251, 213, 251, 11, 249, 130, 252, 220, 255,
        254, 3, 152, 5, 74, 8, 242, 250, 135, 1, 159, 254, 33, 8, 16, 250, 138,
        250, 136, 6, 112, 7, 208, 250, 221, 248, 209, 1, 244, 254, 15, 3, 242,
        247, 166, 253, 31, 255, 111, 253, 165, 254, 119, 251, 138, 248, 11, 249,
        210, 2, 208, 1, 241, 4, 120, 250, 179, 5, 96, 3, 217, 255, 43, 2, 56, 7,
        122, 250, 125, 249, 16, 253, 240, 1, 105, 0, 43, 0, 152, 1, 129, 254,
        190, 3, 230, 7, 197, 0, 59, 5, 19, 250, 169, 250, 26, 5, 238, 251, 190,
        251, 42, 3, 171, 254, 209, 5, 17, 254, 221, 2, 29, 249, 53, 3, 23, 252,
        150, 7, 106, 249, 160, 2, 23, 254, 250, 8, 233, 4, 108, 254, 30, 1, 63,
        250, 15, 5, 21, 0, 107, 6, 221, 248, 72, 1, 151, 248, 200, 7, 146, 7,
        228, 255, 67,
      ]);

      expect(sk.toBytes(params761)).not.toEqual([
        37, 6, 97, 20, 8, 41, 102, 136, 0, 8, 89, 132, 66, 37, 69, 170, 66, 10,
        134, 85, 10, 165, 145, 68, 37, 166, 106, 104, 37, 149, 149, 106, 36,
        146, 169, 20, 9, 17, 6, 134, 150, 10, 137, 0, 148, 5, 86, 133, 85, 85,
        144, 69, 161, 98, 100, 130, 26, 41, 130, 132, 33, 68, 169, 149, 137, 85,
        24, 86, 81, 137, 33, 40, 38, 66, 137, 40, 0, 134, 81, 86, 149, 96, 166,
        2, 90, 137, 164, 164, 90, 17, 152, 130, 128, 166, 66, 97, 128, 150, 16,
        68, 69, 9, 0, 148, 73, 90, 6, 73, 65, 164, 66, 20, 6, 73, 6, 160, 138,
        133, 102, 72, 97, 5, 90, 160, 88, 146, 4, 24, 128, 160, 10, 136, 128,
        37, 4, 70, 74, 80, 64, 5, 101, 138, 86, 168, 130, 160, 26, 64, 5, 97,
        144, 9, 136, 164, 24, 80, 106, 153, 4, 1, 145, 164, 82, 73, 101, 85, 66,
        20, 1, 96, 26, 102, 25, 162, 17, 5, 137, 26, 136, 152, 150, 65, 102,
        165, 90, 73, 69, 104, 161, 36, 0, 90, 100, 74, 85, 98, 165, 70, 166, 85,
        21, 90, 22, 85, 85, 134, 97, 84, 86, 149, 98, 24, 153, 85, 69, 84, 149,
        85, 89, 69, 82, 105, 64, 89, 130, 106, 89, 90, 149, 149, 86, 153, 137,
        133, 102, 90, 69, 73, 153, 68, 84, 102, 68, 37, 133, 85, 25, 68, 97,
        101, 85, 85, 81, 85, 85, 66, 100, 68, 81, 85, 21, 85, 37, 64, 84, 132,
        148, 101, 66, 101, 86, 21, 82, 101, 85, 101, 89, 22, 101, 149, 37, 102,
        85, 81, 101, 149, 145, 86, 66, 85, 22, 89, 101, 5, 6, 128, 85, 85, 89,
        153, 86, 21, 86, 25, 25, 21, 101, 88, 133, 149, 89, 165, 165, 145, 153,
        21, 145, 130, 81, 145, 38, 101, 88, 89, 85, 102, 89, 85, 89, 65, 149,
        86, 85, 102, 101, 85, 68, 101, 85, 105, 149, 149, 102, 149, 81, 100,
        104, 85, 149, 85, 25, 97, 21, 86, 89, 1, 40, 69, 89, 69, 90, 85, 149,
        146, 86, 40, 149, 134, 82, 21, 168, 69, 4, 84, 85, 149, 69, 69, 73, 89,
        138, 1,
      ]);
    });
  });
});
